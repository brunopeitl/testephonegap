<!DOCTYPE html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <!-- This is a wide open CSP declaration. To lock this down for production, see below. -->
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' gap:; style-src 'self' 'unsafe-inline'; media-src *" />
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <title>Minha Formatura</title>
	
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript">
	
		
	
        function enviar() {
		
			//PEGAR VARIÁVEIS
			var empresa = $("#empresa").val();
			var contrato = $("#contrato").val();
			var album = $("#album").val();
			var senha = $("#senha").val();
			var response;

			if (empresa == '') {
				$("#resposta").html("");
				$("#resposta").html("<p>Preencha o campo Empresa</p>");
			}
			else if (contrato == '') {
				$("#resposta").html("");
				$("#resposta").html("<p>Preencha o campo Contrato</p>");
			}
			else if (album == '') {
				$("#resposta").html("");
				$("#resposta").html("<p>Preencha o campo Album</p>");
			}
			else if (senha == '') {
				$("#resposta").html("");
				$("#resposta").html("<p>Preencha o campo Senha</p>");
			}
			else {
				$.ajax({
				  type: "GET",
				  url: 'http://www.porcocapitalista.com.br/teste4.php',
				  data: {'empresa': empresa, 'contrato': contrato, 'album': album, 'senha': senha},
				  dataType: 'jsonp',
				  jsonp: 'jsoncallback',
				  timeout: 5000,
				  success: function(response, status){
									$("#resposta").html("");
									var caminhocompleto = "http://www.porcocapitalista.com.br"+response+"/05.jpg"
									$("#resposta").html("<p>"+caminhocompleto+"</p>");
									
									
									
									//BAIXAR
									var fileTransfer = new FileTransfer();
									var uri = encodeURI(caminhocompleto);

									fileTransfer.download(
										uri,
										fileURL,
										function(entry) {
											console.log("download complete: " + entry.toURL());
										},
										function(error) {
											console.log("download error source " + error.source);
											console.log("download error target " + error.target);
											console.log("download error code" + error.code);
										},
										false,
										{
											headers: {
												"Authorization": "Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="
											}
										}
									);
									
									
									
									
							}
				});
				
				
			}

	    } 
		
	</script>

	</head>

<body>
    <div class="app">
        <h1>Minha Formatura</h1>
        <p>Essa é a primeira vez que você acessa o Minha Formatura por este dispositivo. Por isso você precisa se identificar para baixar o seu álbum no seu aparelho e assim poder visualizá-lo mesmo quando não estiver conectado à internet.</p>
        

  			<input type="text" id="empresa" name="empresa" placeholder="Empresa" autofocus required>
  			<br>
  			<input type="text" id="contrato" name="contrato" placeholder="Contrato" required>
  			<br>
            <input type="text" id="album" name="album" placeholder="Album" required>
  			<br>
            <input type="password" id="senha" name="senha" placeholder="Senha" required>
  			<br><br>
  			<button onclick="enviar()">BAIXAR ÁLBUM</button>
			
			<div id="resposta"></div>
		
		<p>Não tem as informações necessárias para baixar o seu álbum? Entre em contato com a empresa contratada.</p>

    </div>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript">
        app.initialize();
    </script>
</body>

</html>
